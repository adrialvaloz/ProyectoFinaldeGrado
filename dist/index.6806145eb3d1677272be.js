(()=>{"use strict";const t=function(){function t(t){this.piece=t,this.selected=!1,this.availableMove=!1}return t.prototype.setSelected=function(t){this.selected=t},t.prototype.setPiece=function(t){this.piece=t},t.prototype.setAvailableMovement=function(t){this.availableMove=t},t}();var e=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var o,r,n=i.call(t),l=[];try{for(;(void 0===e||e-- >0)&&!(o=n.next()).done;)l.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return l},i=function(){function i(e,i,o,r,n,l){this.width=e,this.height=i,this.files=o,this.ranks=r,this.theme=n,this.pieceTheme=l,this.flip=!1,this.cellWidth=this.width/this.files,this.cellHeight=this.height/this.ranks,this.pieceOffset=.1*this.cellHeight,this.previousCell=null,this.selectedCells=[],this.$canvas=document.createElement("canvas"),this.ctx=this.$canvas.getContext("2d"),this.$canvas.width=this.width,this.$canvas.height=this.height,document.body.appendChild(this.$canvas),document.body.style.display="grid",document.body.style.placeItems="center",document.body.style.height="100%",document.body.parentElement.style.height="100%",document.body.style.backgroundColor="#333333",this.boardMatrix=[];for(var c=0;c<this.files;c+=1){this.boardMatrix[c]=[];for(var s=0;s<this.ranks;s+=1)this.boardMatrix[c][s]=new t(null)}this.setSelectedCell=this.setSelectedCell.bind(this),this.setMouseCell=this.setMouseCell.bind(this),this.pickPiece=this.pickPiece.bind(this),this.dragPiece=this.dragPiece.bind(this),this.dropPiece=this.dropPiece.bind(this),this.$canvas.addEventListener("mousemove",this.dragPiece),this.$canvas.addEventListener("mousedown",this.pickPiece),this.$canvas.addEventListener("mouseup",this.dropPiece)}return i.prototype.clearSelections=function(){this.selectedCells.forEach((function(t){return t.setSelected(!1)})),this.selectedCells=[]},i.prototype.clearAvailableMoves=function(){this.boardMatrix.forEach((function(t){t.forEach((function(t){t.setAvailableMovement(!1)}))}))},i.prototype.pickPiece=function(t){if(this.clearSelections(),!this.previousCell){var i=t.offsetX,o=t.offsetY,r=e(this.mouseCoordinatesToCell(i,o),2),n=r[0],l=r[1],c=this.boardMatrix[n][l];c.piece&&(c.piece.availableMovements([n,l],this.boardMatrix),this.previousCell=c,this.selectedCells.push(c),c.setSelected(!0),this.render())}},i.prototype.dragPiece=function(t){},i.prototype.dropPiece=function(t){if(this.previousCell){var i=t.offsetX,o=t.offsetY,r=e(this.mouseCoordinatesToCell(i,o),2),n=r[0],l=r[1],c=this.boardMatrix[n][l];if(this.previousCell===c)return console.log("Show valid movements"),this.previousCell=null,this.clearSelections(),void this.render();if(!c.availableMove)return this.previousCell=null,void this.render();c.setPiece(this.previousCell.piece),this.selectedCells.push(c),this.previousCell.setPiece(null),this.previousCell=null,c.setSelected(!0),this.clearAvailableMoves(),this.render()}},i.prototype.mouseCoordinatesToCell=function(t,e){var i=Math.floor(t/this.cellWidth),o=Math.floor(e/this.cellHeight);return this.flip&&(i=this.files-1-i,o=this.ranks-1-o),[i,o]},i.prototype.setSelectedCell=function(t){var i=t.offsetX,o=t.offsetY,r=e(this.mouseCoordinatesToCell(i,o),2),n=r[0],l=r[1];this.boardMatrix[n][l].setSelected(!0),this.render()},i.prototype.setMouseCell=function(t){var e=t.offsetX,i=t.offsetY;console.log({offsetX:e,offsetY:i});var o=Math.floor(e/this.cellWidth),r=Math.floor(i/this.cellHeight);console.log({cellWidth:this.cellWidth,cellHeight:this.cellHeight}),console.log({x:o,y:r})},i.prototype.initPlacePiece=function(t,e,i){this.boardMatrix[t][e].setPiece(i)},i.prototype.render=function(){console.log(this.boardMatrix);for(var t=0;t<this.files;t+=1)for(var e=0;e<this.ranks;e+=1){var i=t,o=e;this.flip&&(i=this.ranks-1-i,o=this.files-1-o);var r=this.theme.light,n=this.theme.dark;(i+o)%2&&(r=this.theme.dark,n=this.theme.light),this.ctx.fillStyle=r,this.ctx.fillRect(i*this.cellWidth,o*this.cellHeight,this.cellWidth,this.cellHeight),this.ctx.fillStyle=n,this.ctx.textBaseline="top",this.ctx.textAlign="start",this.ctx.font="8px Arial",this.ctx.fillText("[".concat(t,";").concat(e,"]"),i*this.cellWidth+10,o*this.cellHeight+10);var l=this.boardMatrix[t][e];l.selected&&(this.ctx.fillStyle="#FFDC4E",this.ctx.fillRect(i*this.cellWidth,o*this.cellHeight,this.cellWidth,this.cellHeight)),l.availableMove&&(this.ctx.fillStyle="#000000",this.ctx.globalAlpha=.3,this.ctx.beginPath(),this.ctx.arc(i*this.cellWidth+this.cellWidth/2,o*this.cellHeight+this.cellHeight/2,16,0,2*Math.PI),this.ctx.fill(),this.ctx.globalAlpha=1);var c=null==l?void 0:l.piece;c&&(this.ctx.fillStyle=this.pieceTheme[c.color],this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.font="72px Arial",this.ctx.fillStyle=c.color,this.ctx.fillText(c.miau[0],i*this.cellWidth+this.cellWidth/2,o*this.cellHeight+this.cellHeight/2+this.pieceOffset),this.ctx.fillStyle=this.pieceTheme.dark,this.ctx.fillText(c.miau[1],i*this.cellWidth+this.cellWidth/2,o*this.cellHeight+this.cellHeight/2+this.pieceOffset))}},i}();const o=i;var r=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var o,r,n=i.call(t),l=[];try{for(;(void 0===e||e-- >0)&&!(o=n.next()).done;)l.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return l},n=function(){function t(t,e,i){this.color=t,this.miau=e,this.type=i,this.moved=!1}return t.prototype.getCellFromCoords=function(t,e){var i=r(t,2),o=i[0],n=i[1];return(e[o]||[])[n]},t.prototype.checkDirection=function(t,e,i){for(var o=r(t,2),n=o[0],l=o[1],c=r(e,2),s=c[0],a=c[1],h=1;h<=i.length;h+=1){var f=this.getCellFromCoords([n+h*s,l+h*a],i);if(!f)break;if(f.piece&&f.piece.color===this.color)break;if(f.setAvailableMovement(!0),f.piece)break}},t.prototype.validCell=function(t){return t&&!(t.piece&&t.piece.color===this.color)},t.prototype.availableMovements=function(t,e){throw new Error("Missing availableMovements in ".concat(this.type))},t}();const l=n;var c,s;!function(t){t.light="light",t.dark="dark"}(c||(c={})),function(t){t.king="k",t.queen="q",t.rook="r",t.bishop="b",t.knight="n",t.pawn=""}(s||(s={}));var a,h=(a=function(t,e){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},a(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),f=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var o,r,n=i.call(t),l=[];try{for(;(void 0===e||e-- >0)&&!(o=n.next()).done;)l.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return l},u=function(t){function e(e){return t.call(this,e,["♟","♙"],s.pawn)||this}return h(e,t),e.prototype.availableMovements=function(t,e){for(var i=this.color===c.dark?1:-1,o=f(t,2),r=o[0],n=o[1],l=1;l<=(this.moved?1:2);l+=1){var s=this.getCellFromCoords([r,n+l*i],e);if(s.piece)break;s.setAvailableMovement(!0)}for(l=0;l<2;l+=1){var a=this.getCellFromCoords([r+(l?1:-1),n+1*i],e);a&&a.piece&&a.piece.color!==this.color&&a.setAvailableMovement(!0)}},e}(l);const p=u;var d=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();const v=function(t){function e(e){return t.call(this,e,["♜","♖"],s.rook)||this}return d(e,t),e.prototype.availableMovements=function(t,e){this.checkDirection(t,[0,-1],e),this.checkDirection(t,[1,0],e),this.checkDirection(t,[0,1],e),this.checkDirection(t,[-1,0],e)},e}(l);var y=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),b=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var o,r,n=i.call(t),l=[];try{for(;(void 0===e||e-- >0)&&!(o=n.next()).done;)l.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return l};const g=function(t){function e(e){return t.call(this,e,["♞","♘"],s.knight)||this}return y(e,t),e.prototype.availableMovements=function(t,e){var i=this,o=b(t,2),r=o[0],n=o[1];[[r-1,n-2],[r+1,n-2],[r+2,n-1],[r+2,n+1],[r+1,n+2],[r-1,n+2],[r-2,n+1],[r-2,n-1]].forEach((function(t){var o=i.getCellFromCoords(t,e);i.validCell(o)&&o.setAvailableMovement(!0)}))},e}(l);var m=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();const C=function(t){function e(e){return t.call(this,e,["♝","♗"],s.bishop)||this}return m(e,t),e.prototype.availableMovements=function(t,e){this.checkDirection(t,[1,1],e),this.checkDirection(t,[-1,1],e),this.checkDirection(t,[1,-1],e),this.checkDirection(t,[-1,-1],e)},e}(l);var x=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();const P=function(t){function e(e){return t.call(this,e,["♛","♕"],s.queen)||this}return x(e,t),e.prototype.availableMovements=function(t,e){var i=this;[[1,1],[-1,1],[1,-1],[-1,-1],[0,-1],[1,0],[0,1],[-1,0]].forEach((function(o){return i.checkDirection(t,o,e)}))},e}(l);var k=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),w=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var o,r,n=i.call(t),l=[];try{for(;(void 0===e||e-- >0)&&!(o=n.next()).done;)l.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return l};const _=function(t){function e(e){return t.call(this,e,["♚","♔"],s.king)||this}return k(e,t),e.prototype.availableMovements=function(t,e){var i=this,o=w(t,2),r=o[0],n=o[1];if([[1,1],[-1,1],[1,-1],[-1,-1],[0,-1],[1,0],[0,1],[-1,0]].forEach((function(t){var o=w(t,2),l=o[0],c=o[1],s=i.getCellFromCoords([r+1*l,n+1*c],e);i.validCell(s)&&s.setAvailableMovement(!0)})),!this.moved){var l=this.getCellFromCoords([r+1,n],e),c=this.getCellFromCoords([r+2,n],e),a=this.getCellFromCoords([r+3,n],e);l.piece||c.piece||!a.piece||a.piece.type!==s.rook||a.piece.moved||c.setAvailableMovement(!0);var h=this.getCellFromCoords([r-1,n],e),f=this.getCellFromCoords([r-2,n],e),u=this.getCellFromCoords([r-3,n],e),p=this.getCellFromCoords([r-4,n],e);h.piece||f.piece||u.piece||!p.piece||p.piece.type!==s.rook||p.piece.moved||f.setAvailableMovement(!0)}},e}(l);for(var M=new o(800,800,8,8,{light:"#fbce9c",dark:"#d38d47"},{light:"#FFFFFF",dark:"#000000"}),S=0;S<8;S+=1)M.initPlacePiece(S,1,new p(c.dark)),M.initPlacePiece(S,6,new p(c.light));for(S=0;S<2;S+=1)M.initPlacePiece(0,7*S,new v(S?c.light:c.dark)),M.initPlacePiece(7,7*S,new v(S?c.light:c.dark)),M.initPlacePiece(1,7*S,new g(S?c.light:c.dark)),M.initPlacePiece(6,7*S,new g(S?c.light:c.dark)),M.initPlacePiece(2,7*S,new C(S?c.light:c.dark)),M.initPlacePiece(5,7*S,new C(S?c.light:c.dark)),M.initPlacePiece(3,7*S,new P(S?c.light:c.dark)),M.initPlacePiece(4,7*S,new _(S?c.light:c.dark));M.render()})();